# Copilot Token Tracker - Session Log Files Knowledge Base

## Overview

This repository uses the **Copilot Token Tracker** VS Code extension to track GitHub Copilot usage. Collaborators can optionally upload their local Copilot session log files to Azure Blob Storage, making them available as references for the GitHub Copilot Coding Agent.

## Session Log Files

### What Are Session Log Files?

Session log files are JSON or JSONL files generated by the GitHub Copilot Chat extension. They contain:

- **Request/response interactions**: User prompts and Copilot responses
- **Token usage data**: Estimated input/output tokens per interaction
- **Model information**: Which AI model was used (e.g., gpt-4o, claude-opus-4)
- **Timestamps**: When each interaction occurred
- **Context references**: What files, symbols, or tools were referenced

### File Formats

#### Format 1: JSON (VS Code Copilot Chat)
```json
{
  "requests": [
    {
      "timestamp": "2026-02-11T10:30:00.000Z",
      "message": {
        "parts": [{"value": "How do I optimize this query?"}]
      },
      "response": [
        {"value": "To optimize this query, consider..."}
      ],
      "model": "gpt-4o"
    }
  ]
}
```

#### Format 2: JSONL (Copilot CLI)
```jsonl
{"timestamp":"2026-02-11T10:30:00.000Z","type":"user.message","data":{"content":"Help me debug this issue"},"model":"gpt-4o"}
{"timestamp":"2026-02-11T10:30:05.000Z","type":"assistant.message","data":{"output":"Let's analyze the issue..."},"model":"gpt-4o"}
```

## Azure Blob Storage Integration

### Container Structure

Uploaded session files are organized in a hierarchical structure:

```
copilot-session-logs/
├── default/                          # Dataset ID
│   ├── <machine-id-1>/               # Machine ID (GUID)
│   │   ├── 2026-02-11/              # Date (YYYY-MM-DD)
│   │   │   ├── session-abc123.json.gz
│   │   │   └── session-def456.json.gz
│   │   └── 2026-02-12/
│   │       └── session-xyz789.json.gz
│   └── <machine-id-2>/
│       └── 2026-02-11/
│           └── session-ghi012.json.gz
```

### File Compression

Files are compressed with gzip by default to reduce storage costs and bandwidth.

## Configuration for Extension Users

### Enable Blob Upload

In VS Code settings (`settings.json`):

```json
{
  "copilotTokenTracker.backend.enabled": true,
  "copilotTokenTracker.backend.storageAccount": "your-storage-account",
  "copilotTokenTracker.backend.blobUploadEnabled": true,
  "copilotTokenTracker.backend.blobContainerName": "copilot-session-logs",
  "copilotTokenTracker.backend.blobUploadFrequencyHours": 24,
  "copilotTokenTracker.backend.blobCompressFiles": true
}
```

### Authentication

The extension uses Microsoft Entra ID (Azure RBAC) via `DefaultAzureCredential` or Storage Shared Key.

Required Azure roles:
- **Storage Blob Data Contributor**: For uploading files
- **Storage Blob Data Reader**: For reading uploaded files

## Loading Log Files in Coding Agent

See `.github/workflows/copilot-setup-steps.yml` for an example of how to download and make session logs available to the GitHub Copilot Coding Agent.

**Important**: Session log files contain full text of prompts and responses which may be sensitive. Use appropriate access controls.
