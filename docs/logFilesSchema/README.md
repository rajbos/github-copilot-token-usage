# Session File Schema Documentation

This directory contains documentation and analysis of GitHub Copilot session file schemas.

## Files

### session-file-schema.json
**Manually curated documentation** of the Copilot session file structure. This file describes:
- File locations and formats (.json and .jsonl)
- Complete schema for JSON session files
- Complete schema for JSONL session files  
- Which fields the extension actually uses
- Detailed descriptions and examples

This is the **primary reference** for understanding session file structure.

### session-file-schema-analysis.json
**Auto-generated analysis** from actual session files on disk. Generated by running:
```powershell
.\scripts\analyze-session-schema.ps1
```

Contains:
- All discovered field paths with types and examples
- Field occurrence counts
- Detection of new fields not in the manual documentation

## Updating the Schema

### When to Update

Run the analysis script periodically to detect schema changes:
- After GitHub Copilot updates
- When adding new features to the extension
- Monthly check for new fields

### How to Update

1. **Run the analysis script:**
   ```powershell
   .\scripts\analyze-session-schema.ps1 -MaxFiles 10
   ```

2. **Review new fields detected:**
   The script will highlight any new field paths found that aren't in `session-file-schema.json`

3. **Investigate new fields:**
   - Open `session-file-schema-analysis.json`
   - Look for new field paths in the `newFieldsDetected` section
   - Check the `fields` section for type and example values

4. **Update manual documentation:**
   - Add newly discovered fields to `session-file-schema.json`
   - Add descriptions and note whether the extension should use them
   - Update the version and lastUpdated date

5. **Consider extension updates:**
   - If new fields contain useful data (e.g., actual token counts), consider updating the extension to use them
   - Update the extension's parsing logic in `src/extension.ts`

## Script Parameters

The analysis script accepts several parameters:

```powershell
# Analyze more files for better coverage
.\scripts\analyze-session-schema.ps1 -MaxFiles 20

# Save to a different location
.\scripts\analyze-session-schema.ps1 -OutputFile "temp-analysis.json"

# Skip comparison with existing documentation
.\scripts\analyze-session-schema.ps1 -CompareWithExisting $false
```

## Reading the Analysis Output

The `session-file-schema-analysis.json` file contains:

```json
{
  "generatedAt": "timestamp",
  "filesAnalyzed": {
    "json": 6,
    "jsonl": 3
  },
  "newFieldsDetected": {
    "json": [...],   // New fields not in documentation
    "jsonl": [...]
  },
  "jsonFileSchema": {
    "totalFields": 35269,
    "fields": {
      "fieldPath": {
        "type": "string|number|boolean|array|object",
        "count": 10,        // How many times seen
        "examples": [...]   // Sample values
      }
    }
  },
  "jsonlFileSchema": { ... },
  "topLevelJsonFields": [...],
  "commonJsonlEventTypes": [...]
}
```

## Field Path Notation

- `fieldName` - Top-level field
- `parent.child` - Nested field
- `array[]` - Array items
- `array[].field` - Field in array items

Example: `requests[].response[].value` = the `value` field in items of the `response` array within items of the `requests` array.

## Common Tasks

### Find fields related to token counting
```powershell
$analysis = Get-Content docs\logFilesSchema\session-file-schema-analysis.json | ConvertFrom-Json
$analysis.jsonFileSchema.fields.PSObject.Properties | Where-Object { $_.Name -like "*token*" }
```

### Check what models are detected
```powershell
$analysis = Get-Content docs\logFilesSchema\session-file-schema-analysis.json | ConvertFrom-Json
$analysis.jsonFileSchema.fields.'result.details'.examples
```

### List all JSONL event types
```powershell
$analysis = Get-Content docs\logFilesSchema\session-file-schema-analysis.json | ConvertFrom-Json
$analysis.commonJsonlEventTypes
```

## Notes

- The analysis script only processes the first few items in large arrays to keep the output manageable
- Fields that appear infrequently might indicate optional fields or special scenarios
- JSONL files typically have fewer unique field paths because events share common structure
